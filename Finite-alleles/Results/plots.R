library("viridis")

# =================== Cost profiles for the SD schedules =======================
th = 0.5
c = 0.1
n = 2^(5:16)
y = n^(c^(1/(th * log(n))))
col=viridis(4)[1:3]
Mhi = 1e4
mlo = 1e2
ylim=c(mlo * min(n), Mhi * max(n))
pdf("cost-profiles.pdf")
plot(n, Mhi * n, log="xy", ylim=ylim, type="l", col=col[1], lwd=2, xlab="Sample size", ylab="Cost", cex.lab=1.3, cex.axis=1.3, main = "Cost of SD schedules", cex.main = 1.3)
par(new=TRUE)
plot(n, Mhi * y + (n - y) * mlo, log="xy", ylim=ylim, type="l", col=col[2], lwd=2, xaxt="n", yaxt="n", xlab="", ylab="")
par(new=TRUE)
plot(n, mlo * n, log="xy", ylim=ylim, type="l", col=col[3], lwd=2, xaxt="n", yaxt="n", xlab="", ylab="")
legend("topleft", legend=c("Schedule 1", "Schedule 2 & 4", "Scedule 3"), lwd=c(2,2,2), col=col, cex=1.3)
dev.off()
# ==============================================================================

# =================== cost with 10k particles under SD =========================
cost_50_sd = read.table("./cost-50-sd.txt")
cost_500_sd = read.table("./cost-500-sd.txt")
cost_5000_sd = read.table("./cost-5000-sd.txt")
ymax = log10(max(cost_50_sd, cost_500_sd, cost_5000_sd))
col = viridis(3)
pdf("cost-sd.pdf")
plot(cost_50_sd[,1], log10(cost_50_sd[,2]), type="l", lwd=2, xlab = "Fraction of sample size", ylab = "log(E[W^2] / E[W]^2) (base 10)", cex.lab=1.3, cex.axis=1.3, ylim = c(0, ymax), main = "Stephens-Donnelly", cex.main = 1.3, col=col[1])
par(new=TRUE)
plot(cost_500_sd[,1], log10(cost_500_sd[,2]), type="l", lwd=2, xlab = "", ylab = "", xaxt="n", yaxt="n", ylim = c(0, ymax), col=col[2])
par(new=TRUE)
plot(cost_5000_sd[,1], log10(cost_5000_sd[,2]), type="l", lwd=2, xlab = "", ylab = "", xaxt="n", yaxt="n", ylim = c(0, ymax), col=col[3])
legend("topright", legend=c("n = 50 (1m 15s)", "n = 500 (15m)", "n = 5000 (3h 45m)"), lwd=c(2,2,2), col = col, cex=1.3)
dev.off()
# ==============================================================================

# =================== cost with 10k particles under GT =========================
cost_50_gt = read.table("./cost-50-gt.txt")
cost_500_gt = read.table("./cost-500-gt.txt")
cost_5000_gt = read.table("./cost-5000-gt.txt")
col = viridis(3)
ymax = log10(max(cost_50_gt, cost_500_gt, cost_5000_gt))
pdf("cost-gt.pdf")
plot(cost_50_gt[,1], log10(cost_50_gt[,2]), type="l", lwd=2, xlab = "Fraction of sample size", ylab = "log(E[W^2] / E[W]^2) (base 10)", cex.lab=1.3, cex.axis=1.3, ylim = c(0, ymax), main = "Griffiths-Tavare", cex.main = 1.3, col=col[1])
par(new=TRUE)
plot(cost_500_gt[,1], log10(cost_500_gt[,2]), type="l", lwd=2, xlab = "", ylab = "", xaxt="n", yaxt="n", ylim = c(0, ymax), col=col[2])
par(new=TRUE)
plot(cost_5000_gt[,1], log10(cost_5000_gt[,2]), type="l", lwd=2, xlab = "", ylab = "", xaxt="n", yaxt="n", ylim = c(0, ymax), col=col[3])
legend("topright", legend=c("n = 50 (8m)", "n = 500 (17m)", "n = 5000 (1h 10m)"), lwd=c(2,2,2), col = col, cex=1.3)
dev.off()
# ==============================================================================

# ========= Data for 20 locus likelihood surfaces ==============================
likelihood_10k_50 = read.table("./likelihood-10k-results-50.txt")
likelihood_10k_500 = read.table("./likelihood-10k-results-500.txt")
likelihood_10k_5000 = read.table("./likelihood-10k-results-5000.txt")
likelihood_variable_50 = read.table("./likelihood-variable-results-50.txt")
likelihood_variable_500 = read.table("./likelihood-variable-results-500.txt")
likelihood_variable_5000 = read.table("./likelihood-variable-results-5000.txt")
likelihood_100_50 = read.table("./likelihood-100-results-50.txt")
likelihood_100_500 = read.table("./likelihood-100-results-500.txt")
likelihood_100_5000 = read.table("./likelihood-100-results-5000.txt")
likelihood_mean_50 = read.table("./likelihood-mean-results-50.txt")
likelihood_mean_500 = read.table("./likelihood-mean-results-500.txt")
likelihood_mean_5000 = read.table("./likelihood-mean-results-5000.txt")

# ======== 20 locus likelihood surface as per Stephens & Donnelly (2000) =======
th = seq(0.1, 0.9, 0.1)
p = 13
col=viridis(4)
pdf("likelihood-50.pdf")
plot(th, exp(likelihood_10k_50[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "theta", ylab = paste0("Likelihood * 10^", 13), cex.lab=1.3, cex.axis=1.3, main = "n = 50", cex.main = 1.3, col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_10k_50[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_10k_50[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_10k_50[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_10k_50[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_variable_50[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_variable_50[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_variable_50[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_variable_50[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_variable_50[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_100_50[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_100_50[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_100_50[,3] + 2 * p * log(10) - 2 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="",col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_100_50[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_100_50[,3] + 2 * p * log(10) - 2 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="",col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_mean_50[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[4])
par(new=TRUE)
plot(th, exp(likelihood_mean_50[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_mean_50[,3] + 2 * p * log(10) - log(7846))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[4])
par(new=TRUE)
plot(th, exp(likelihood_mean_50[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_mean_50[,3] + 2 * p * log(10) - log(7846))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[4])
legend("topleft", legend = c("Schedule 1 (10m 13s)", "Schedule 2 (38s)", "Schedule 3 (6s)", "Schedule 4 (39s)", "2 Standard errors"), lty = c(1, 1, 1, 1, 2), lwd=c(2,2,2,2,2), col=c(col, "black"), cex=1.3)
dev.off()
# ==============================================================================

# ======== 20 locus likelihood surface for n = 500==============================
th = seq(0.1, 0.9, 0.1)
p = 21
col=viridis(4)
pdf("likelihood-500.pdf")
plot(th, exp(likelihood_10k_500[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "theta", ylab = paste0("Likelihood * 10^", p), cex.lab=1.3, cex.axis=1.3, main = "n = 500", cex.main = 1.3, col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_10k_500[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_10k_500[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_10k_500[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_10k_500[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_variable_500[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_variable_500[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_variable_500[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_variable_500[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_variable_500[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_100_500[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_100_500[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_100_500[,3] + 2 * p * log(10) - 2 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_100_500[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_100_500[,3] + 2 * p * log(10) - 2 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_mean_500[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[4])
par(new=TRUE)
plot(th, exp(likelihood_mean_500[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_mean_500[,3] + 2 * p * log(10) - log(1330))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[4])
par(new=TRUE)
plot(th, exp(likelihood_mean_500[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_mean_500[,3] + 2 * p * log(10) - log(1330))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[4])
legend("bottomright", legend = c("Schedule 1 (2h 26m)", "Schedule 2 (5m 44s)", "Schedule 3 (1m 28s)", "Schedule 4 (8m 41s)", "2 Standard errors"), lty = c(1, 1, 1, 1, 2), lwd=c(2,2,2,2,2), col=c(col, "black"), cex=1.3)
dev.off()
# ==============================================================================

# ======== 20 locus likelihood surface for n = 5000=============================
th = seq(0.1, 0.9, 0.1)
p = 28
col=viridis(4)
pdf("likelihood-5000.pdf")
plot(th, exp(likelihood_10k_5000[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 3), xlab = "theta", ylab = paste0("Likelihood * 10^", p), cex.lab=1.3, cex.axis=1.3, main = "n = 5 000", cex.main = 1.3, col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_10k_5000[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_10k_5000[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,3), xaxt="n", yaxt="n", xlab="", ylab="", col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_10k_5000[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_10k_5000[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,3), xaxt="n", yaxt="n", xlab="", ylab="", col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_variable_5000[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 3), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_variable_5000[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_variable_5000[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,3), xaxt="n", yaxt="n", xlab="", ylab="", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_variable_5000[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_variable_5000[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,3), xaxt="n", yaxt="n", xlab="", ylab="", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_100_5000[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 3), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_100_5000[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_100_5000[,3] + 2 * p * log(10) - 2 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,3), xaxt="n", yaxt="n", xlab="", ylab="", col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_100_5000[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_100_5000[,3] + 2 * p * log(10) - 2 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,3), xaxt="n", yaxt="n", xlab="", ylab="", col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_mean_5000[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 3), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[4])
par(new=TRUE)
plot(th, exp(likelihood_mean_5000[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_mean_5000[,3] + 2 * p * log(10) - log(269))), type = "l", lwd=2, lty=2, ylim=c(0,3), xaxt="n", yaxt="n", xlab="", ylab="", col=col[4])
par(new=TRUE)
plot(th, exp(likelihood_mean_5000[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_mean_5000[,3] + 2 * p * log(10) - log(269))), type = "l", lwd=2, lty=2, ylim=c(0,3), xaxt="n", yaxt="n", xlab="", ylab="", col=col[4])
legend("topleft", legend = c("Schedule 1 (24h 18m)", "Schedule 2 (1h)", "Schedule 3 (17m 48s)", "Schedule 4 (59m 27s)", "2 Standard errors"), lty = c(1, 1, 1, 1, 2), lwd=c(2,2,2,2,2), col=c(col, "black"), cex=1.3)
dev.off()
# ==============================================================================

# ========= Data for 20 locus likelihood surfaces with resampling ==============
likelihood_10k_50 = read.table("./likelihood-10k-results-50-re.txt")
likelihood_variable_50 = read.table("./likelihood-variable-results-50-re.txt")
likelihood_100_50 = read.table("./likelihood-100-results-50-re.txt")
likelihood_mean_50 = read.table("./likelihood-mean-results-50-re.txt")

# ======== 20 locus likelihood surface as per Stephens & Donnelly (2000) =======
th = seq(0.1, 0.9, 0.1)
p = 13
col=viridis(4)
pdf("likelihood-50-re.pdf")
plot(th, exp(likelihood_10k_50[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "theta", ylab = paste0("Likelihood * 10^", 13), cex.lab=1.3, cex.axis=1.3, main = "n = 50", cex.main = 1.3, col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_10k_50[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_10k_50[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_10k_50[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_10k_50[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[1])
par(new=TRUE)
plot(th, exp(likelihood_variable_50[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_variable_50[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_variable_50[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_variable_50[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_variable_50[,3] + 2 * p * log(10) - 4 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[2])
par(new=TRUE)
plot(th, exp(likelihood_100_50[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_100_50[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_100_50[,3] + 2 * p * log(10) - 2 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="",col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_100_50[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_100_50[,3] + 2 * p * log(10) - 2 * log(10))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="",col=col[3])
par(new=TRUE)
plot(th, exp(likelihood_mean_50[,2] + p * log(10)), type = "l", lwd=2, ylim=c(0, 5), xlab = "", ylab = "", xaxt="n", yaxt="n", col=col[4])
par(new=TRUE)
plot(th, exp(likelihood_mean_50[,2] + p * log(10)) + 2 * sqrt(exp(likelihood_mean_50[,3] + 2 * p * log(10) - log(7846))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[4])
par(new=TRUE)
plot(th, exp(likelihood_mean_50[,2] + p * log(10)) - 2 * sqrt(exp(likelihood_mean_50[,3] + 2 * p * log(10) - log(7846))), type = "l", lwd=2, lty=2, ylim=c(0,5), xaxt="n", yaxt="n", xlab="", ylab="", col=col[4])
legend("topleft", legend = c("Schedule 1 (9m 22s)", "Schedule 2 (44s)", "Schedule 3 (4s)", "Schedule 4 (40s)", "2 Standard errors"), lty = c(1, 1, 1, 1, 2), lwd=c(2,2,2,2,2), col=c(col, "black"), cex=1.3)
dev.off()
# ==============================================================================